<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <meta name="description" content="Hmmm a lil about me i guess" />
  <meta name="author" content="" />

  <link rel="icon" type="image/x-icon" href="https://dcdn.dstn.to/avatars/754033245972201612">
  <link rel="stylesheet" media="screen" href="css/style.css">
  <title>404 Not Found</title>

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"> </script>

 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <link rel="stylesheet" href="..//newmain/style.css">
  
 <link rel="stylesheet" href="../assets/activitycard.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/19746ffdef.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

   


    <style>
:root{
    --bg:#0f1720; --card:#0b1220; --muted:#9aa4b2; --accent:#7dd3fc; --glass: rgba(255,255,255,0.03);
    --radius:14px; --maxw:9200px; --gap:18px; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  }
  

  .container{
    width:100%; max-width:var(--maxw); margin:0 auto;
  }

  header{
    display:flex; gap:12px; align-items:center; margin-bottom:18px;
  }
  .brand{font-weight:700; letter-spacing:0.2px; font-size:18px}
  .sub{color:var(--muted); font-size:13px}

  .main-card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius); padding:18px; box-shadow: 0 6px 20px rgba(2,6,23,0.6); margin-bottom:22px;
  }

  .grid{
    display:grid; grid-template-columns: 220px 1fr; gap:16px; align-items:start;
  }

  .thumb{
    width:220px; height:140px; border-radius:12px; overflow:hidden; background:linear-gradient(180deg,#0b1422,#061018);
    display:flex; align-items:center; justify-content:center; flex-shrink:0;
  }
  .thumb img{width:100%; height:100%; object-fit:cover; display:block}

  .title-row{display:flex; justify-content:space-between; align-items:flex-start; gap:12px;}
  h1{margin:0; font-size:20px}
  .meta{color:var(--muted); font-size:13px; margin-top:6px}
  .btn-row{margin-top:12px; display:flex; gap:10px}
  .btn{
    background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--accent);
    padding:8px 12px; border-radius:10px; font-weight:600; font-size:13px; text-decoration:none;
    display:inline-flex; gap:8px; align-items:center;
  }

  /* Markdown content */
  .content{
    margin-top:12px; color:#e8f2fb; line-height:1.55; font-size:15px;
    background:var(--glass); padding:14px; border-radius:10px; border:1px solid rgba(255,255,255,0.02);
  }
  .content h2{font-size:18px; margin-top:10px}
  .content pre{background:rgba(0,0,0,0.4); padding:12px; border-radius:8px; overflow:auto}
  .content code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:13px}
  .author-row{display:flex; gap:12px; align-items:center; margin-top:10px}
  .author-row img{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.03)}
  .author-meta{font-size:13px; color:var(--muted)}
  .author-name{color:#fff; font-weight:600}

  /* carousel / feed */

  /* carousel / feed */
.carousel-wrap {
  margin-top: 18px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.carousel {
  display: flex;
  flex-wrap: wrap;          /* allow wrapping into multiple rows */
  gap: 12px;
  max-height: 480px;        /* 2 rows ~ 2 * card height + gaps */
  overflow-y: auto;         /* scroll vertically if overflow */
  padding: 8px;
}

.card {
  flex: 1 1 260px;          /* flexible grid item, min width */
  max-width: 260px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
  border-radius: 12px;
  padding: 10px;
  border: 1px solid rgba(255,255,255,0.02);
}

/* list view */
.list {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 12px;
  max-height: 500px;        /* set a max height */
  overflow-y: auto;         /* enable scrollbar */
}

.list-item {
  display: flex;
  gap: 12px;
  align-items: center;
  background: rgba(255,255,255,0.02);
  padding: 10px;
  border-radius: 10px;
}

  .card .c-thumb{height:110px; border-radius:8px; overflow:hidden; margin-bottom:8px}
  .c-thumb img{width:100%; height:100%; object-fit:cover}
  .c-title{font-weight:700; font-size:14px; line-height:1.2}
  .c-sub{font-size:12px; color:var(--muted); margin-top:6px}

  .controls{display:flex; gap:8px}
  .icon-btn{background:transparent; border:1px solid rgba(255,255,255,0.04); padding:8px;border-radius:10px;color:var(--muted); cursor:pointer}

  .view-toggle{margin-left:auto; display:flex; gap:8px; align-items:center}

  /* list view */
 
  .list-item img{width:64px;height:48px; object-fit:cover; border-radius:8px}
  .list-body{display:flex; flex-direction:column}
  .list-title{font-weight:700}
  .list-sub{font-size:13px; color:var(--muted)}

  /* small responsive */
  @media (max-width:720px){
    .grid{grid-template-columns:1fr; }
    .thumb{width:100%; height:160px}
    .carousel{padding-bottom:12px}
    .card{min-width:220px; max-width:220px}
  }

</style>

</head>
<body>
  
    <aside class="sidebar" id="sidebar">
        <nav class="nav">
            <div class="nav-logo">
                          
<div class="botuu-section">
    <div class="botucircle" id="bot-face">
        <div class="eye-white-container">
            <div class="eye-white">
                <div class="eye-ball"></div>
            </div>
            <div class="eye-white">
                <div class="eye-ball"></div>
            </div>
        </div>
    </div>
</div>

<div class="mouse-capture"></div>



            </div>

            <!-- <div class="nav-logo">
                <a href="#" class="nav-logo-text"><img src="https://dcdn.dstn.to/avatars/754033245972201612" style="border-radius: 50%;"></a>
            </div> -->

            <div class="nav-menu">
                <div class="menu">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#home" class="nav-link active-link">Home</a>
                        </li>

                        <li class="nav-item">
                            <a href="#dash" class="nav-link">Cards</a>
                        </li>

                        
                        <li class="nav-item">
                            <a href="#contact-form" class="nav-link">Contact</a>
                        </li>

                    </ul>
                </div>
            </div>

            <div class="btn-share">
                <i class="uil uil-share-alt social-share"></i>
            </div>

            <div class="nav-close" id="nav-close">
                <i class="uil uil-times"></i>
            </div>
        </nav>
    </aside>

    <main class="main">
        <section class="home" id="home">
            <div class="home-container container grid">
                <div class="home-social">
                  
                    <span class="home-social-follow">RajatCJ</span> 
                    <a class="home-social-link" href="https:/rajatcj.com/"><i class="uil uil-user button-icon"></i></a>
                    
                </div>



                <div class="container" id="app">
          <div>
            <div class="brand">Naito Blog</div>
            <div class="sub">Minimal blog feed rendered from Lanyard KV JSON</div>
          </div>

          <main id="mainArea">
            <div class="main-card" id="mainCard" aria-live="polite">
              <!-- Filled by JS -->
              <div id="loading">Loading blogs...</div>
            </div>

            
          </main>
        </div>






            
        </div>

            
        </section>


        <section class="about section" id="dash">
            <h2 class="section-title" data-heading=".... .- .-. . / -.- .-. .. ... .... -. .-"></h2>


             <div id="belowArea" class="below-area">
              <div class="view-toggle">
                <label class="switch">
                  <input type="checkbox" id="viewSwitch">
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">Carousel / List</span>
              </div>
              <div class="carousel-wrap">
                <div id="carousel" class="carousel"></div>
                <div id="listView" class="list hidden"></div>
              </div>
            </div>
        </section>

        <!--
                <section class="about section" id="aboutme">
            <h2 class="section-title" data-heading="A little more">About Me</h2>

            <div class="about-container container grid">
     
                <div class="about-data">
                    <h3 class="about-heading">Hi, I'm Mariam Wallas, based in Canada</h3>
                    <p class="about-description">I'm a web developer, with extensive knowledge and years of experience, working with quality work in web technologies, UI and UX design</p>




                    </div>
                
                    <div class="about-info">
                        <div class="about-box">
                            <i class="uil uil-award about-icon"></i>
                            <h3 class="about-title">Experience</h3>
                            <span class="about-subtitle">10 + Years</span>
                        </div>

                        <div class="about-box">
                            <i class="uil uil-suitcase-alt about-icon"></i>
                            <h3 class="about-title">Completed</h3>
                            <span class="about-subtitle">60 + Projects</span>
                        </div>

                        <div class="about-box">
                            <i class="uil uil-headphones-alt about-icon"></i>
                            <h3 class="about-title">Support</h3>
                            <span class="about-subtitle">Online 24/7</span>
                        </div>
                    </div>
            </div>

        </section>
-->

        <footer class="footer">
            <div class="footer-bg">
                <div class="footer-container container grid">
                    

                    <div>
                        <h1 onclick="window.location='mailto:mail@rajatcj.com'" class="footer-title" style="cursor: pointer;">mail@rajatcj.com</h1>
                        <span class="footer-subtitle">Made with <i class="fa-brands fa-html5"></i> HTML5, <i class="fa-brands fa-css3-alt"></i> CSS3, <i class="fa-brands fa-square-js"></i> JS, <i class="fa-brands fa-bootstrap"></i> Bootstrap, <i class="fa-solid fa-q"></i> JQuery, <i class="fa-brands fa-node"></i> node.js, <i class="fa-solid fa-font-awesome"></i> Fontawesome and <i class="fa-solid fa-tag"></i> Lanyard by <b><i class="fa-solid fa-at"></i>rajat_cj</b> on 20th March, 2023</span>
                    </div>

    <div class="footer-navigate">
      <div class="nav">
        <h5>Socials</h5>
        <p class="links" onclick="location.href='https://instagram.com/rajat_cj';" style="cursor: pointer;"><i class="fa-brands fa-instagram"></i> Instagram</p>
        <p class="links" onclick="location.href='https://www.snapchat.com/add/rajat_cj';" style="cursor: pointer;"><i class="fa-brands fa-snapchat"></i> Snapchat</p>
        <p class="links" onclick="location.href='https://twitter.com/rajat_cj';" style="cursor: pointer;"><i class="fa-brands fa-twitter"></i> Twitter</p>
        <p class="links" onclick="location.href='https://www.reddit.com/u/rajat_cj';" style="cursor: pointer;"><i class="fa-brands fa-reddit"></i> Reddit</p>
      </div>
      <div class="nav">
        <h5>Other Sites</h5>
        <p class="links" onclick="location.href='https://rajatcj.com/portfolio';" style="cursor: pointer;"><i class="fa-solid fa-globe"></i> Portfolio</p>
        <p class="links" onclick="location.href='https://rajatcj.com/linktree';" style="cursor: pointer;"><i class="fa-solid fa-link"></i> Linktree</p>
        <p class="links" onclick="location.href='https://snippets.jharajat.com.np/';" style="cursor: pointer;"><i class="fa-solid fa-code"></i> Snippets</p>
        <p class="links" onclick="location.href='https://botuu.jharajat.com.np/';" style="cursor: pointer;"><i class="fa-solid fa-face-smile"></i> Discord Bot</p>
      </div>
      <div class="nav">
        <h5>Discords</h5>
        <p class="links" onclick="location.href='https://discord.gg/UAaRzNz87W';" style="cursor: pointer;"><i class="fa-brands fa-discord"></i> Botu's Crewmates</p>
        <p class="links" onclick="location.href='https://discord.gg/nepal';" style="cursor: pointer;"><i class="fa-brands fa-discord"></i> The Namaste Nepal</p>
        <p class="links" onclick="location.href='https://discord.gg/theopn';" style="cursor: pointer;"><i class="fa-brands fa-discord"></i> One Piece Nepal</p>
        <p class="links" onclick="location.href='https://discord.gg/Vy9RgnjSVC';" style="cursor: pointer;"><i class="fa-brands fa-discord"></i> Medicos</p>
      </div>
    </div>
                </div>

                <p class="footer-copy">&#169; <a href="https://rajatcj.com/">RajatCJ</a>, 2025. All rights reserved</p>
            </div>
        </footer>
    </main>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/mixitup/3.3.1/mixitup.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
     
<!-- partial -->
  <script  src="../newmain/script.js"></script>


<script src="../assets/chatid.js"></script>
<script src="../assets/msgsend.js"></script>

<script>
/* -----------------------
   Utility helpers
   ----------------------- */

const API_URL = 'https://api.lanyard.rest/v1/users/754033245972201612';
const TIMEZONE = 'Asia/Kathmandu'; // as requested

function q(selector, el=document) { return el.querySelector(selector); }
function create(tag, attrs={}, children=[]) {
  const el = document.createElement(tag);
  for (const k in attrs) {
    if (k === 'text') el.textContent = attrs[k];
    else if (k === 'html') el.innerHTML = attrs[k];
    else el.setAttribute(k, attrs[k]);
  }
  children.forEach(c => typeof c === 'string' ? el.appendChild(document.createTextNode(c)) : el.appendChild(c));
  return el;
}

function escapeHtml(s){
  return String(s)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');
}

function isProbablyUrl(s){
  try {
    if(!s || typeof s !== 'string') return false;
    s = s.trim();
    // allow https, http, mailto
    return /^(https?:\/\/|mailto:|\/\/)/i.test(s) || /^www\./i.test(s);
  } catch(e){ return false; }
}
function normalizeUrl(s){
  if(!s) return '';
  s = s.trim();
  if(/^www\./i.test(s)) return 'https://' + s;
  if(/^\/\//.test(s)) return location.protocol + s;
  return s;
}
function isSafeUrl(url){
  if(!url) return false;
  const u = url.trim().toLowerCase();
  if(u.startsWith('javascript:')) return false;
  if(u.startsWith('data:')) return false; // avoid inline data URIs
  return /^(https?:\/\/|mailto:|\/|#)/i.test(u);
}

/* -----------------------
   Small Markdown -> HTML converter (safe)
   - Escape input first.
   - Then run limited markdown transforms.
   - Sanitize generated urls and image src.
   ----------------------- */
function markdownToHtml(md){
  if(md == null) return '';
  // ensure it's a string
  let s = String(md);
  // escape first
  s = escapeHtml(s);

  // Code blocks ```lang\n...\n```
  s = s.replace(/```([\s\S]*?)```/g, (m, code) => {
    return `<pre><code>${code.replace(/</g,'&lt;')}</code></pre>`;
  });

  // Inline code `code`
  s = s.replace(/`([^`]+)`/g, (m, c) => `<code>${c.replace(/</g,'&lt;')}</code>`);

  // Headings (###### to #)
  s = s.replace(/^###### (.*$)/gm, '<h6>$1</h6>');
  s = s.replace(/^##### (.*$)/gm, '<h5>$1</h5>');
  s = s.replace(/^#### (.*$)/gm, '<h4>$1</h4>');
  s = s.replace(/^### (.*$)/gm, '<h3>$1</h3>');
  s = s.replace(/^## (.*$)/gm, '<h2>$1</h2>');
  s = s.replace(/^# (.*$)/gm, '<h1>$1</h1>');

  // Bold **text**
  s = s.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
  // Italic *text* or _text_
  s = s.replace(/(^|[^*])\*(.*?)\*(?!\*)/g, '$1<em>$2</em>');
  s = s.replace(/_(.*?)_/g, '<em>$1</em>');

  // Images ![alt](url)
  s = s.replace(/!\[([^\]]*?)\]\(([^)]+?)\)/g, (m, alt, url) => {
    url = url.trim();
    const normalized = normalizeUrl(url);
    if(!isSafeUrl(normalized)) return `<img alt="${escapeHtml(alt)}" />`; // drop src if unsafe
    return `<img alt="${escapeHtml(alt)}" src="${escapeHtml(normalized)}" />`;
  });

  // Links [text](url)
  s = s.replace(/\[([^\]]+?)\]\(([^)]+?)\)/g, (m, text, url) => {
    url = url.trim();
    const normalized = normalizeUrl(url);
    if(!isSafeUrl(normalized)) return `<span>${text}</span>`;
    const target = /^mailto:/i.test(normalized) ? '' : ' target="_blank" rel="noopener noreferrer"';
    return `<a href="${escapeHtml(normalized)}"${target}>${text}</a>`;
  });

  // Ordered lists (1.)
  // Convert lines starting with digits + dot
  s = s.replace(/(^|\n)\s*\d+\.\s+(.+?)(?=\n|$)/g, (m, pre, item) => `${pre}<li>${item}</li>`);
  // Wrap consecutive <li> into <ol>
  s = s.replace(/(<li>[\s\S]*?<\/li>)(?:\s*(<li>[\s\S]*?<\/li>))+/g, (m) => {
    const items = m.match(/<li>[\s\S]*?<\/li>/g).join('');
    return `<ol>${items}</ol>`;
  });

  // Unordered lists (- or *)
  s = s.replace(/(^|\n)\s*[-*]\s+(.+?)(?=\n|$)/g, (m, pre, item) => `${pre}<li>${item}</li>`);
  s = s.replace(/(<li>[\s\S]*?<\/li>)(?:\s*(<li>[\s\S]*?<\/li>))+/g, (m) => {
    // be careful: if it's already in <ol>, skip
    if(/<ol>/.test(m)) return m;
    const items = m.match(/<li>[\s\S]*?<\/li>/g).join('');
    return `<ul>${items}</ul>`;
  });

  // Paragraphs: wrap lines separated by blank line with <p>, but avoid wrapping headings, lists, pre, code, block elements
  s = s.split(/\n\s*\n/).map(block => {
    const trimmed = block.trim();
    if(!trimmed) return '';
    if(/^(<h|<ul|<ol|<pre|<img|<p|<blockquote|<code)/.test(trimmed)) return trimmed;
    return `<p>${trimmed.replace(/\n/g,'<br>')}</p>`;
  }).join('\n');

  return s;
}

/* -----------------------
   Date / timestamp helper
   ----------------------- */
function parseTimestampMaybe(text){
  if(text == null) return null;
  const s = String(text).trim();
  if(/^\\d{10}$/.test(s)){ // seconds
    const dt = new Date(parseInt(s,10)*1000);
    return dt;
  }
  if(/^\\d{13}$/.test(s)){ // ms
    const dt = new Date(parseInt(s,10));
    return dt;
  }
  // try numeric parse
  const num = Number(s);
  if(!Number.isNaN(num) && num > 1e9){
    // heuristics: if > 1e12 treat as ms
    const dt = new Date(num > 1e12 ? num : num*1000);
    if(!isNaN(dt.getTime())) return dt;
  }
  return null;
}
function formatDate(dt){
  if(!dt) return '';
  try {
    return dt.toLocaleString('en-GB', {
      timeZone: TIMEZONE,
      year:'numeric', month:'short', day:'2-digit',
      hour:'2-digit', minute:'2-digit'
    });
  } catch(e){ return dt.toString(); }
}

/* -----------------------
   Render logic
   ----------------------- */

async function loadAndRender(){
  const mainCard = q('#mainCard');
  mainCard.innerHTML = '<div id="loading">Loading blogs...</div>';

  try {
    const resp = await fetch(API_URL, {cache:'no-store'});
    if(!resp.ok) throw new Error('API fetch failed: ' + resp.status);
    const obj = await resp.json();
    const kv = (obj && obj.data && obj.data.kv) ? obj.data.kv : null;
    if(!kv) {
      mainCard.innerHTML = '<div>No KV data found in API response.</div>';
      return;
    }

    // iterate keys in kv -> parse JSON values and pick those with main+card
    const blogs = [];
    for(const key of Object.keys(kv)){
      const raw = kv[key];
      // raw might be a string already with JSON inside. Try to parse.
      if(typeof raw !== 'string') continue;
      let parsed;
      try {
        parsed = JSON.parse(raw);
      } catch(e){
        // sometimes the value itself may be escaped JSON (double-encoded) - try unescape and parse
        try {
          parsed = JSON.parse(unescape(raw));
        } catch(e2){
          // not JSON - skip
          continue;
        }
      }
      // ensure structure main + card
      if(parsed && parsed.main && parsed.card){
        blogs.push({ key, data: parsed });
      }
    }

    if(blogs.length === 0){
      mainCard.innerHTML = '<div>No blog entries found in KV in expected format (main + card).</div>';
      return;
    }

    // sort by creation time if possible (info2.text might be timestamp). We'll try to parse each's timestamp; newest first
    blogs.forEach(b => {
      const info2 = b.data.card && b.data.card.detail && b.data.card.detail.info2;
      let t = null;
      if(info2){
        // info2.text might be timestamp or text
        const maybe = parseTimestampMaybe(info2.text);
        if(maybe) t = maybe.getTime();
      }
      b._ts = t || 0;
    });
    blogs.sort((a,b) => (b._ts - a._ts));

    // check query param id
    const urlParams = new URLSearchParams(location.search);
    const idParam = urlParams.get('id');

    // render first/main
    let mainBlog;
    if(idParam){
      mainBlog = blogs.find(x=>x.key === idParam) || blogs[0];
    } else {
      mainBlog = blogs[0];
    }

    renderMain(mainBlog, blogs);
    renderBelow(blogs, mainBlog.key);

  } catch(err){
    console.error(err);
    q('#mainCard').innerHTML = '<div>Error loading blogs: ' + escapeHtml(err.message || err) + '</div>';
  }
}

function safeLinkOrText(possible){
  if(!possible) return '';
  if(isProbablyUrl(possible)) {
    const url = normalizeUrl(possible);
    if(isSafeUrl(url)) return `<a href="${escapeHtml(url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(possible)}</a>`;
    return escapeHtml(possible);
  }
  return escapeHtml(possible);
}

function renderMain(blogObj, allBlogs){
  const mainCard = q('#mainCard');
  const data = blogObj.data;
  const key = blogObj.key;

  const title = data.main.title || '(Untitled)';
  const detail = data.main.detail || '';
  const pribtn = data.main.pribtn || null;
  const secbtn = data.main.secbtn || null;

  const card = data.card || {};
  const cardImg = card.img || '';
  const info1 = card.detail && card.detail.info1 ? card.detail.info1 : {};
  const info2 = card.detail && card.detail.info2 ? card.detail.info2 : {};

  // author info
  const authorImg = info1.img || '';
  const authorName = info1.name || '';
  const authorPrice = info1.price || ''; // instagram handle or link

  // info2: contains text and icon (text maybe timestamp or plain text; icon maybe location)
  let dateText = '';
  const parsedDate = parseTimestampMaybe(info2.text);
  if(parsedDate) dateText = formatDate(parsedDate);
  else if(info2.text) dateText = escapeHtml(info2.text);

  let locationText = '';
  if(info2.icon){
    // if looks like a url, use domain as location display; else use as given text
    if(isProbablyUrl(info2.icon)) {
      const u = normalizeUrl(info2.icon);
      locationText = escapeHtml(u);
    } else {
      locationText = escapeHtml(info2.icon);
    }
  }

  // Build HTML
  const htmlParts = [];

  // grid with thumbnail and title+meta
  const grid = create('div',{class:'grid'});
  const thumb = create('div',{class:'thumb'});
  if(cardImg && isSafeUrl(cardImg)){
    const img = create('img',{src:normalizeUrl(cardImg), alt:title});
    thumb.appendChild(img);
  } else {
    thumb.appendChild(create('div',{text:'No image', style:'color:var(--muted)'}));
  }
  grid.appendChild(thumb);

  const right = create('div');
  const titleRow = create('div',{class:'title-row'});
  titleRow.appendChild(create('h1',{text:title}));
  // small meta
  const metaWrap = create('div',{style:'text-align:right'});
  metaWrap.appendChild(create('div',{class:'meta', html:`${locationText ? 'üìç ' + locationText : ''} ${locationText && dateText ? '¬∑' : ''} ${dateText ? 'üïí ' + escapeHtml(dateText) : ''}`}));
  titleRow.appendChild(metaWrap);
  right.appendChild(titleRow);

  // author row
  const authRow = create('div',{class:'author-row'});
  const aImg = create('img',{src: isSafeUrl(authorImg)? normalizeUrl(authorImg) : '', alt:authorName});
  authRow.appendChild(aImg);
  const ameta = create('div',{class:'author-meta'});
  ameta.appendChild(create('div',{class:'author-name', text: authorName || 'Unknown author'}));
  let priceHtml = '';
  if(authorPrice){
    // if it starts with @, link to instagram if looks like handle
    if(/^@/.test(authorPrice.trim())) {
      const handle = authorPrice.trim().replace(/^@/,'');
      priceHtml = `<div class="sub">${'<a href="https://instagram.com/' + escapeHtml(handle) + '" target="_blank" rel="noopener noreferrer">'}${escapeHtml(authorPrice)}</a></div>`;
    } else if(isProbablyUrl(authorPrice)){
      priceHtml = `<div class="sub"><a href="${escapeHtml(normalizeUrl(authorPrice))}" target="_blank" rel="noopener noreferrer">${escapeHtml(authorPrice)}</a></div>`;
    } else {
      priceHtml = `<div class="sub">${escapeHtml(authorPrice)}</div>`;
    }
  }
  ameta.insertAdjacentHTML('beforeend', priceHtml);
  authRow.appendChild(ameta);
  right.appendChild(authRow);

  // buttons
  const btnRow = create('div',{class:'btn-row'});
  if(pribtn && pribtn.link && pribtn.text){
    const l = normalizeUrl(pribtn.link);
    if(isSafeUrl(l)) btnRow.appendChild(create('a',{class:'btn', href:l, target:'_blank', rel:'noopener noreferrer', html: escapeHtml(pribtn.text)}));
  }
  if(secbtn && secbtn.link && secbtn.text){
    const l2 = normalizeUrl(secbtn.link);
    if(isSafeUrl(l2)) btnRow.appendChild(create('a',{class:'btn', href:l2, target:'_blank', rel:'noopener noreferrer', html: escapeHtml(secbtn.text)}));
  }

  right.appendChild(btnRow);

  // markdown content area
  const content = create('div',{class:'content'});
  content.innerHTML = markdownToHtml(detail);

  right.appendChild(content);

  grid.appendChild(right);

  mainCard.innerHTML = ''; // clear loading
  mainCard.appendChild(grid);

  // below area will also show carousel etc
}

/* -----------------------
   Below area rendering: carousel + view toggle + list
   ----------------------- */
function renderBelow(blogs, currentKey){
  const below = q('#belowArea');
  below.innerHTML = '';

  const wrap = create('div', {class:'carousel-wrap'});

  const controls = create('div', {class:'controls'});
  const leftBtn = create('button',{class:'icon-btn', type:'button', title:'Scroll left', text:'‚óÄ'});
  const rightBtn = create('button',{class:'icon-btn', type:'button', title:'Scroll right', text:'‚ñ∂'});
  controls.appendChild(leftBtn);
  controls.appendChild(rightBtn);

  // view toggle
  const viewToggle = create('div',{class:'view-toggle'});
  const carouselBtn = create('button',{class:'btn', type:'button', text:'Carousel'});
  const listBtn = create('button',{class:'btn', type:'button', text:'List'});
  viewToggle.appendChild(carouselBtn);
  viewToggle.appendChild(listBtn);

  wrap.appendChild(controls);
  wrap.appendChild(viewToggle);
  below.appendChild(wrap);

  // carousel element
  const carousel = create('div',{class:'carousel', id:'carouselArea'});
  blogs.forEach(b => {
    const c = create('article',{class:'card', tabindex:0});
    const th = create('div',{class:'c-thumb'});
    if(b.data.card && b.data.card.img && isSafeUrl(b.data.card.img)){
      th.appendChild(create('img',{src:normalizeUrl(b.data.card.img), alt:b.data.main && b.data.main.title || 'thumb'}));
    } else {
      th.appendChild(create('div',{text:'No image'}));
    }
    c.appendChild(th);
    c.appendChild(create('div',{class:'c-title', text: b.data.main && b.data.main.title || '(Untitled)'}));

    // subtitle / author and small meta
    const info1 = b.data.card && b.data.card.detail && b.data.card.detail.info1 ? b.data.card.detail.info1 : {};
    const info2 = b.data.card && b.data.card.detail && b.data.card.detail.info2 ? b.data.card.detail.info2 : {};
    let subtitle = '';
    if(info1 && info1.name) subtitle = info1.name;
    let small = subtitle;
    // date/time
    const parsed = parseTimestampMaybe(info2.text);
    if(parsed){
      small += (small ? ' ¬∑ ' : '') + formatDate(parsed);
    } else if(info2 && info2.text){
      small += (small ? ' ¬∑ ' : '') + escapeHtml(info2.text);
    }
    c.appendChild(create('div',{class:'c-sub', html: small}));

    // clicking card -> go to ?id=key
    c.addEventListener('click', ()=> {
      const url = new URL(location.href);
      url.searchParams.set('id', b.key);
      // navigate
      location.href = url.toString();
    });

    carousel.appendChild(c);
  });
  below.appendChild(carousel);

  // List view (hidden by default)
  const list = create('div',{class:'list', id:'listArea', style:'display:none;'});
  blogs.forEach(b => {
    const li = create('div',{class:'list-item'});
    const img = create('img',{src: (b.data.card && b.data.card.img && isSafeUrl(b.data.card.img)) ? normalizeUrl(b.data.card.img) : '', alt: (b.data.main && b.data.main.title) || 'thumb'});
    li.appendChild(img);
    const bd = create('div',{class:'list-body'});
    bd.appendChild(create('div',{class:'list-title', text: b.data.main && b.data.main.title || '(Untitled)'}));
    const info1 = b.data.card && b.data.card.detail && b.data.card.detail.info1 ? b.data.card.detail.info1 : {};
    const info2 = b.data.card && b.data.card.detail && b.data.card.detail.info2 ? b.data.card.detail.info2 : {};
    let sub = info1.name || '';
    const parsed = parseTimestampMaybe(info2.text);
    if(parsed){
      sub += (sub ? ' ¬∑ ' : '') + formatDate(parsed);
    } else if(info2 && info2.text){
      sub += (sub ? ' ¬∑ ' : '') + escapeHtml(info2.text);
    }
    bd.appendChild(create('div',{class:'list-sub', html: sub}));
    li.appendChild(bd);

    li.addEventListener('click', ()=> {
      const url = new URL(location.href);
      url.searchParams.set('id', b.key);
      location.href = url.toString();
    });

    list.appendChild(li);
  });
  below.appendChild(list);

  // wire buttons
  leftBtn.addEventListener('click', ()=> {
    carousel.scrollBy({left:-300, behavior:'smooth'});
  });
  rightBtn.addEventListener('click', ()=> {
    carousel.scrollBy({left:300, behavior:'smooth'});
  });

  carouselBtn.addEventListener('click', ()=> {
    carousel.style.display = ''; list.style.display = 'none';
    carouselBtn.classList.add('active'); listBtn.classList.remove('active');
  });
  listBtn.addEventListener('click', ()=> {
    carousel.style.display = 'none'; list.style.display = '';
    listBtn.classList.add('active'); carouselBtn.classList.remove('active');
  });

  // focus current blog card: attempt to scroll it into view
  setTimeout(()=> {
    const idx = blogs.findIndex(x=>x.key === currentKey);
    if(idx >= 0){
      const child = carousel.children[idx];
      if(child) child.scrollIntoView({behavior:'smooth', inline:'center'});
    }
  }, 120);
}

loadAndRender();
</script>

</body>
</html>
